---
title: 浅谈 HTTP
layout: default
categories: [计算机网络]
---

# 浅谈 HTTP

学习开发时间也不短了，一直觉得知识体系不够系统，也不够深入。结合最近看的一些书以及一些开发的经历来
理一下自己 HTTP 的理解。**由于能力所限，总结带有猜测成分，有待日后完善。**

HTTP 协议是一种应用层的通信规范。HTTP 报文本质上就是有特定格式的一些文本，报文依次通过传输层、网络层和数据
链路层和物理层的配合传输到其他主机，最后到达其他主机的应用层，其他主机按照 HTTP 规范对报文进行解析。HTTP
报文分为请求报文和响应报文。

### 请求报文

请求报文一般格式如下：

```
POST /cgi-bin HTTP/1.1
Host: example.com

paramA=A&paramB=B
```

以上请求报文分为请求行、请求头以及请求体，请求行分为请求方法、请求路径以及协议版本三个部分，每个部分以空格分隔。
常见的方法有`GET`、`POST`、`PUT`、`DELETE`等，请求协议一般为`HTTP/1.1`或者`HTTP/1.0`。请求首部对请求
进行详细说明，例如以上的`Host: example.com`指明了要请求的主机，除了`Host`还有`Content-Length`等首部。
请求体与请求首部之间以空行分隔，一般用来传输额外的数据，可以传输多个数据格式。

最常用的请求方法应该是`GET`和`POST`了，也有很多文章会解释这两个方法有什么区别，最近我也看了一些类似的文章，
也用`telnet`配合一些的代码进行过简单的试验。以我目前的理解，现在一般的 web 服务器都会忽略`GET`方法请求报文的
请求体，也就是说`GET`方法也是可以有请求体的，可能也有一些特殊的服务器不会忽略`GET`的请求体。`GET`方法使用 URL
来传递参数，主要用来进行查询。由于 URL 有长度的限制，所以也可以说`GET`方法的参数长度有限制。其实`POST`也可以
在 URL 上附加参数，web 服务器当然也可以接收`POST`方法通过 URL 传过来的参数了，不过一般情况下`POST`方法通过请求
体来传递参数。因此`POST`方法可传输的数据也就比`GET`方法大得多（**这里也可以说`POST`可以传递无限的数据，有待查证**）。
`POST`方法一般用于提交数据。

### 响应报文

响应报文是对请求报文的应答，分为响应行、响应首部和响应体三部分。一般格式如下：

```
HTTP/1.1 200 OK
Content-Length: 21
Content-Type: text/html;charset=UTF-8

<h1>Hello world!</h1>
```

首行是响应行，分为协议版本、状态码和状态原因短语三部分，每部分以空格分隔。响应行下面是响应首部，
响应首部与响应体之间以空格分隔。

### 浅析浏览器和 web 服务器的 HTTP 通信

一般开发并不需要了解这些知识，但了解这些知识能让自己理解一些错误的深层原因。

使用现在的高级语言可以很方便地设置 Cookie、进行基本安全认证等，但是背后是怎么实现的呢？就以 Cookie 的设置为例，
用户通过浏览器进行登录时，登录成功后一般都会生成 Cookie，之后对其他页面的访问都会带上该 Cookie，从而浏览到个性化
内容。那么这个过程是怎样的呢？

首先，用户通过浏览器发送登录请求：

```
POST /account HTTP/1.1
Host: example.com
Content-Length: 22
Content-Type: application/x-www-form-urlencoded

name=user&password=pwd
```

登录成功后，web 服务器会发出如下响应报文：

```
HTTP/1.1 200 OK
Set-Cookie: token=123456
Content-Length: 0
Content-Type: text/html; charset=UTF-8
```

浏览器获取到 Set-Cookie 头后，会自行设置 Cookie。因此，如果以其他方式进行登录时，要自行处理 Set-Cookie 头。在该
Cookie 失效前，浏览器根据 Cookie 的相应参数，请求该地址的其他有效路径时会带上 Cookie，报文如下：

```
GET /info HTTP/1.1
Host: example.com
Cookie: token=123456
```

添加 Cookie 请求头也是浏览器自行处理的，同样，以其他方式请求时，要自行处理 Cookie 头。

Session 一般和 Cookie 进行搭配使用，Session 是保存在服务端的，当然除了 Cookie，还有其他方式可以获取 Session。
以我使用过的语言来说，通常在设置 Session 时，会自动在响应报文中添加 Cookie 头，这个 Cookie 就是 Session 的钥匙。

以上就是 HTTP 通信的一些简单解释，与 Cookie 类似，其他的首部也是类似的用法，客户端与服务端就是通过这些 HTTP 头部
进行解析通信的。