---
title: 给 PHP 写 C 扩展
layout: post
categories: [PHP]
keywords: PHP,C,扩展
---

事先准备，源码编译安装 PHP


```bash
$ # 获取 PHP 源码并编译
$ git clone https://github.com/php/php-src.git
$ git checkout PHP-8.1
$ cd php-src
$ ./buildconf
$ ./configure
$ make
$ make install
```

PHP 源码的扩展目录

```bash
$ cd ext
```

生成扩展基本代码，`hello`为扩展名

```bash
$ php ext_skel.php --ext hello
```

尝试添加一个函数`test3`

```bash
$ cd hello
$ vim hello.c
```

将函数加入 stub 中

```bash
$ vim hello.stub.php
```

编译安装扩展

```bash
$ phpize
$ ./configure
$ make
$ make install
```

编辑`php.ini`加入`extension=hello`

查看扩展信息

```bash
$ php -m | grep hello
$ php --re hello
```

运行扩展函数

```bash
$ php -r 'test3();'
```
